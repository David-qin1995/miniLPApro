# 📋 部署路径说明

## ✅ 最终部署路径

```
/www/wwwroot/minilpa-web
```

## 📦 目录结构

```
/www/wwwroot/minilpa-web/
├── client/                    # 前端代码
│   ├── dist/                 # 构建输出 ← Nginx 指向这里
│   ├── src/                  # 源代码
│   ├── package.json
│   └── vite.config.js
├── server/                   # 后端代码
│   ├── routes/              # API 路由
│   ├── lpac/                # LPAC 集成
│   ├── db.js                # 数据库
│   └── index.js             # 入口文件 ← PM2 运行这里
├── data/                     # 数据存储
│   └── db.json              # 数据库文件
├── logs/                     # 日志目录
│   ├── nginx-access.log     # Nginx 访问日志
│   └── nginx-error.log      # Nginx 错误日志
├── uploads/                  # 上传文件
├── scripts/                  # 部署脚本
│   └── baota-deploy.sh      # 通用部署脚本
├── docs/                     # 文档
├── .env                      # 环境变量
├── package.json              # 后端依赖
├── ecosystem.config.js       # PM2 配置
└── 一键部署到esim.haoyiseo.com.sh  # 专属部署脚本
```

## 🚀 如何部署到这个路径

### 方式一：一键命令（推荐）⭐

```bash
cd /www/wwwroot && \
git clone https://github.com/David-qin1995/miniLPApro.git temp-minilpa && \
mv temp-minilpa/minilpa-web minilpa-web && \
rm -rf temp-minilpa && \
cd minilpa-web && \
bash 一键部署到esim.haoyiseo.com.sh
```

### 方式二：分步执行

```bash
# 步骤 1: 克隆仓库
cd /www/wwwroot
git clone https://github.com/David-qin1995/miniLPApro.git temp-minilpa

# 步骤 2: 提取 minilpa-web 目录
mv temp-minilpa/minilpa-web minilpa-web
rm -rf temp-minilpa

# 步骤 3: 进入项目目录
cd minilpa-web

# 步骤 4: 运行部署脚本
bash 一键部署到esim.haoyiseo.com.sh
```

## 🌐 Nginx 配置

Nginx 配置文件中的路径：

```nginx
server {
    server_name esim.haoyiseo.com;
    
    # 前端静态文件
    location / {
        root /www/wwwroot/minilpa-web/client/dist;  # ← 这里
        try_files $uri $uri/ /index.html;
    }
    
    # 日志文件
    access_log /www/wwwroot/minilpa-web/logs/nginx-access.log;  # ← 这里
    error_log /www/wwwroot/minilpa-web/logs/nginx-error.log;    # ← 这里
}
```

## ⚙️ PM2 配置

PM2 配置文件 `ecosystem.config.js`：

```javascript
module.exports = {
  apps: [{
    name: 'minilpa',
    script: './server/index.js',  # ← 相对于 /www/wwwroot/minilpa-web
    cwd: '/www/wwwroot/minilpa-web',  # ← 工作目录
  }]
}
```

## 🔍 验证路径

部署完成后，验证路径是否正确：

```bash
# 检查项目目录
ls -la /www/wwwroot/minilpa-web/

# 应该看到：
# client/
# server/
# data/
# logs/
# uploads/
# package.json
# .env
# 等文件

# 检查前端构建文件
ls -la /www/wwwroot/minilpa-web/client/dist/

# 应该看到：
# index.html
# assets/
# 等文件

# 检查 PM2 进程
pm2 status

# 应该看到：
# minilpa | online | /www/wwwroot/minilpa-web/server/index.js
```

## ❓ 常见问题

### Q: 为什么不是 `/www/wwwroot/minilpa/minilpa-web`？

A: 因为仓库结构是 `miniplapro/minilpa-web/`，如果直接克隆会导致路径多一层。我们通过先克隆到临时目录，再提取 `minilpa-web` 目录的方式，确保最终路径简洁明了。

### Q: 可以用其他路径吗？

A: 可以！但需要修改以下文件：
- `scripts/baota-deploy.sh` 中的 `PROJECT_DIR`
- `nginx-esim.haoyiseo.com.conf` 中的所有路径
- `ecosystem.config.js` 中的 `cwd`
- `.env` 中的相关路径

### Q: 如何更新代码？

```bash
cd /www/wwwroot/minilpa-web

# 方式一：Git pull（如果是 Git 仓库）
git pull

# 方式二：重新下载
cd /www/wwwroot
rm -rf minilpa-web
git clone https://github.com/David-qin1995/miniLPApro.git temp-minilpa
mv temp-minilpa/minilpa-web minilpa-web
rm -rf temp-minilpa

# 重新部署
cd minilpa-web
npm install
cd client && npm install && cd ..
npm run build
pm2 restart minilpa
```

## ✅ 总结

- **部署路径**: `/www/wwwroot/minilpa-web`
- **前端构建**: `/www/wwwroot/minilpa-web/client/dist`
- **后端入口**: `/www/wwwroot/minilpa-web/server/index.js`
- **数据库**: `/www/wwwroot/minilpa-web/data/db.json`
- **日志目录**: `/www/wwwroot/minilpa-web/logs/`
- **上传目录**: `/www/wwwroot/minilpa-web/uploads/`

所有配置文件和脚本都已按此路径配置好，直接使用即可！ 🎉
