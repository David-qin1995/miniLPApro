# ✅ 宝塔部署方案已准备完成！

## 🎉 为您准备的部署文件

我已经为您准备好了完整的宝塔 CentOS 7 部署方案：

### 📁 新增文件

| 文件 | 说明 |
|------|------|
| **宝塔部署指南.md** | 📖 详细的部署文档（包含所有步骤） |
| **scripts/baota-deploy.sh** | 🚀 一键部署脚本（自动化部署） |
| **快速部署到宝塔.txt** | ⚡ 快速参考指南 |
| **部署命令清单.sh** | 📋 所有命令的清单 |

---

## 🚀 部署方式

### 方式一：一键部署（最简单）

```bash
# 1. SSH 登录服务器
ssh root@your-server-ip

# 2. 进入宝塔目录
cd /www/wwwroot

# 3. 上传项目（Git 或手动上传）
git clone <your-repo> minilpa

# 4. 执行一键部署
cd minilpa
bash scripts/baota-deploy.sh
```

**完成！** 🎉

### 方式二：手动部署（详细控制）

参考 `宝塔部署指南.md` 逐步操作。

---

## 📋 部署路径

```
/www/wwwroot/minilpa
```

已完全按照您的要求配置！

---

## ⚙️ 部署脚本功能

`baota-deploy.sh` 会自动完成：

1. ✅ 检查环境（Node.js、PM2、Nginx）
2. ✅ 安装所有依赖
3. ✅ 配置环境变量（.env）
4. ✅ 构建前端
5. ✅ 设置目录权限
6. ✅ 配置 PM2（自动启动、开机自启）
7. ✅ 配置 Nginx（反向代理、静态文件）
8. ✅ 配置防火墙
9. ✅ 验证部署

---

## 📝 部署前准备

### 在宝塔面板中安装：

□ Nginx (推荐最新版)
□ PM2 管理器
□ Node.js (v16 或 v18)

### 服务器要求：

□ CentOS 7
□ 至少 1GB 内存
□ 至少 10GB 磁盘空间

---

## 🔧 部署后配置

### 1. 修改域名

编辑 `.env` 文件：
```bash
vim /www/wwwroot/minilpa/.env
```

修改：
```bash
CORS_ORIGIN=https://your-actual-domain.com
```

### 2. 配置 SSL（可选）

在宝塔面板中：
1. 网站 → 设置 → SSL
2. 申请 Let's Encrypt 证书
3. 开启强制 HTTPS

### 3. 重启服务

```bash
pm2 restart minilpa
nginx -s reload
```

---

## ✅ 验证部署

### 1. 检查服务

```bash
# PM2 状态
pm2 status

# 后端 API
curl http://localhost:3000/api/health

# Nginx 状态
nginx -t
```

### 2. 浏览器访问

```
http://your-domain.com
```

---

## 📊 项目结构（部署后）

```
/www/wwwroot/minilpa/
├── client/
│   └── dist/              # 前端（Nginx 访问）
├── server/
│   ├── index.js           # 后端入口（PM2 运行）
│   ├── routes/            # API 路由
│   └── lpac/              # LPAC 集成
├── data/                  # 数据库
├── uploads/               # 上传文件
├── logs/                  # 日志
├── .env                   # 环境变量（重要！）
├── ecosystem.config.js    # PM2 配置
└── scripts/
    └── baota-deploy.sh    # 部署脚本
```

---

## 📚 文档索引

| 文档 | 用途 | 推荐 |
|------|------|------|
| **宝塔部署指南.md** | 完整部署文档 | ⭐⭐⭐⭐⭐ |
| **快速部署到宝塔.txt** | 快速参考 | ⭐⭐⭐⭐ |
| **部署命令清单.sh** | 命令参考 | ⭐⭐⭐ |
| docs/baota-deployment.md | 详细技术文档 | ⭐⭐⭐⭐ |

---

## 🎯 部署流程图

```
┌─────────────────────────────────────┐
│  准备服务器                         │
│  - CentOS 7                         │
│  - 宝塔面板                         │
│  - Nginx + PM2 + Node.js            │
└──────────────┬──────────────────────┘
               │
               ▼
┌─────────────────────────────────────┐
│  上传项目                           │
│  git clone 或手动上传               │
│  路径: /www/wwwroot/minilpa         │
└──────────────┬──────────────────────┘
               │
               ▼
┌─────────────────────────────────────┐
│  执行部署脚本                       │
│  bash scripts/baota-deploy.sh       │
│  (自动完成所有配置)                 │
└──────────────┬──────────────────────┘
               │
               ▼
┌─────────────────────────────────────┐
│  修改配置                           │
│  - 修改域名(.env)                   │
│  - 配置 SSL                         │
└──────────────┬──────────────────────┘
               │
               ▼
┌─────────────────────────────────────┐
│  验证部署                           │
│  - 检查 PM2                         │
│  - 测试 API                         │
│  - 浏览器访问                       │
└──────────────┬──────────────────────┘
               │
               ▼
         ✅ 部署完成！
```

---

## 💡 使用建议

### 开发环境
- 使用模拟模式（USE_MOCK_DATA=true）
- 本地调试

### 测试环境
- 使用模拟模式
- 服务器部署

### 生产环境
- 配置 HTTPS
- 配置真实 lpac（可选）
- 定期备份数据

---

## 🔄 更新流程

```bash
# 1. 进入目录
cd /www/wwwroot/minilpa

# 2. 拉取代码
git pull

# 3. 安装依赖
npm install
cd client && npm install && cd ..

# 4. 重新构建
npm run build

# 5. 重启服务
pm2 restart minilpa
```

---

## ❌ 故障排查

### 快速诊断命令

```bash
# 检查所有服务
pm2 status && nginx -t && curl http://localhost:3000/api/health

# 查看日志
pm2 logs minilpa --lines 50

# 重启所有服务
pm2 restart minilpa && nginx -s reload
```

### 常见问题

参考 `宝塔部署指南.md` 的故障排查章节。

---

## 🔒 安全检查清单

部署后请确认：

□ 已修改 SESSION_SECRET
□ 已配置 CORS_ORIGIN 为实际域名
□ 已配置 SSL 证书
□ 已配置防火墙规则
□ 目录权限正确（www:www）
□ 定期备份计划

---

## 📞 获取帮助

### 部署问题

1. 查看 `宝塔部署指南.md`
2. 检查日志文件
3. 提交 Issue

### LPAC 功能

1. 查看 `LPAC配置说明.md`
2. 运行 `node test-lpac.js`
3. 参考 `docs/lpac-integration.md`

---

## 🎉 总结

### 已准备就绪：

✅ 完整的部署文档
✅ 自动化部署脚本
✅ 详细的命令清单
✅ 故障排查指南
✅ 安全配置建议

### 部署路径已配置：

```
/www/wwwroot/minilpa
```

### 所有配置已优化：

- PM2 配置
- Nginx 配置
- 环境变量
- 目录权限
- 防火墙规则

---

## 🚀 现在就开始部署！

### 最快方式：

```bash
# SSH 登录服务器
ssh root@your-server

# 上传并部署
cd /www/wwwroot
git clone <your-repo> minilpa
cd minilpa
bash scripts/baota-deploy.sh
```

**几分钟后，您的应用就上线了！** 🎊

---

需要帮助？随时查看文档或联系支持！

**祝部署顺利！** 🚀

