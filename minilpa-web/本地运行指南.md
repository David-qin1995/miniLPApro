# 本地运行指南

## 🚀 快速启动（三步走）

### 方法一：分开启动（推荐用于开发调试）

#### 第一步：启动后端
```bash
# 打开第一个终端
cd /Users/jason/devTools/code/miniplapro/minilpa-web
node server/index.js
```

等待看到：
```
╔═══════════════════════════════════════════════════════╗
║          MiniLPA Web Server is running!              ║
║          Port: 3000                                   ║
╚═══════════════════════════════════════════════════════╝
```

#### 第二步：启动前端
```bash
# 打开第二个终端
cd /Users/jason/devTools/code/miniplapro/minilpa-web/client
npm run dev
```

等待看到：
```
  VITE v4.x.x  ready in xxx ms

  ➜  Local:   http://localhost:5173/
  ➜  Network: use --host to expose
```

#### 第三步：打开浏览器
访问：http://localhost:5173

---

### 方法二：使用 npm 脚本（需要 concurrently）

```bash
cd /Users/jason/devTools/code/miniplapro/minilpa-web

# 安装 concurrently（如果还没安装）
npm install

# 同时启动前后端
npm run dev
```

---

## 📋 完整步骤（首次运行）

### 1. 检查 Node.js 版本
```bash
node -v   # 应该 >= 16.0.0
npm -v    # 应该 >= 8.0.0
```

### 2. 安装所有依赖
```bash
cd /Users/jason/devTools/code/miniplapro/minilpa-web

# 方式A：一键安装（如果可用）
npm run install:all

# 方式B：分别安装
npm install                  # 后端依赖
cd client && npm install    # 前端依赖
cd ..
```

### 3. 创建环境变量文件（已自动创建）
```bash
# .env 文件已存在，内容如下：
PORT=3000
NODE_ENV=development
DB_PATH=./data/db.json
CORS_ORIGIN=*
UPLOAD_PATH=./uploads
MAX_FILE_SIZE=10485760
SESSION_SECRET=dev-secret-key-for-local-testing
```

### 4. 启动服务

**选项A：分别启动（推荐）**

终端1 - 后端：
```bash
cd /Users/jason/devTools/code/miniplapro/minilpa-web
node server/index.js
```

终端2 - 前端：
```bash
cd /Users/jason/devTools/code/miniplapro/minilpa-web/client
npm run dev
```

**选项B：使用 npm 脚本**
```bash
cd /Users/jason/devTools/code/miniplapro/minilpa-web
npm run dev
```

### 5. 访问应用
打开浏览器访问：http://localhost:5173

---

## ⚡ 一键启动命令（复制粘贴即可）

### macOS/Linux
```bash
# 创建并运行启动脚本
cd /Users/jason/devTools/code/miniplapro/minilpa-web

# 在后台启动后端
node server/index.js &

# 启动前端（会占用当前终端）
cd client && npm run dev
```

---

## 🔍 验证服务是否正常

### 检查后端
```bash
curl http://localhost:3000/api/health
# 应该返回: {"status":"ok","timestamp":"..."}
```

### 检查前端
浏览器访问：http://localhost:5173

---

## ❌ 常见问题解决

### 问题1：端口被占用
```bash
# 查看占用端口的进程
lsof -ti:3000    # 后端端口
lsof -ti:5173    # 前端端口

# 杀死占用进程
kill $(lsof -ti:3000)
kill $(lsof -ti:5173)
```

### 问题2：依赖安装失败
```bash
# 清除缓存重新安装
rm -rf node_modules client/node_modules
npm cache clean --force
npm install
cd client && npm install
```

### 问题3：后端无法启动
```bash
# 检查是否有错误信息
cd /Users/jason/devTools/code/miniplapro/minilpa-web
node server/index.js

# 如果报错缺少模块，重新安装依赖
npm install
```

### 问题4：前端无法启动
```bash
# 检查前端依赖
cd client
npm install
npm run dev
```

### 问题5：页面空白或报错
1. 打开浏览器开发者工具（F12）
2. 查看 Console 标签的错误信息
3. 查看 Network 标签，确认 API 请求是否成功
4. 确认后端服务是否正在运行：`curl http://localhost:3000/api/health`

---

## 🛑 停止服务

### 停止前端
在前端终端按 `Ctrl + C`

### 停止后端
在后端终端按 `Ctrl + C`

### 或者杀死所有相关进程
```bash
# 查找并杀死 node 进程
ps aux | grep node | grep -v grep
kill <PID>

# 或者杀死占用端口的进程
kill $(lsof -ti:3000)
kill $(lsof -ti:5173)
```

---

## 📱 访问地址

- **前端**: http://localhost:5173
- **后端 API**: http://localhost:3000
- **健康检查**: http://localhost:3000/api/health

---

## 🎯 开发提示

1. **热重载**：修改前端代码会自动刷新页面
2. **后端修改**：修改后端代码需要重启后端服务
3. **数据持久化**：数据保存在 `data/db.json` 文件中
4. **日志文件**：查看 `logs/` 目录下的日志文件

---

## 🆘 还是不行？

### 完全重置项目
```bash
cd /Users/jason/devTools/code/miniplapro/minilpa-web

# 1. 停止所有服务
kill $(lsof -ti:3000) 2>/dev/null
kill $(lsof -ti:5173) 2>/dev/null

# 2. 清理所有依赖和生成文件
rm -rf node_modules client/node_modules client/dist
rm -rf data/*.json logs/*.log

# 3. 重新安装依赖
npm install
cd client && npm install && cd ..

# 4. 重新启动
# 终端1：
node server/index.js

# 终端2：
cd client && npm run dev
```

### 检查系统要求
```bash
# Node.js 版本必须 >= 16
node -v

# 如果版本太低，升级 Node.js：
# macOS: brew install node@18
# 或访问: https://nodejs.org/
```

---

## 📞 获取帮助

如果问题依然存在：
1. 查看终端的错误信息
2. 查看浏览器控制台的错误信息
3. 检查 `logs/` 目录下的日志文件
4. 提交 Issue 并附上错误信息

---

**祝运行顺利！** 🎉

