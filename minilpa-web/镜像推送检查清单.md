# 🔍 镜像推送检查清单

## 📋 快速诊断

### 错误信息分析

```
Error: pull access denied for davidqin1995/minilpa-web
```

**可能的原因**：
1. ❌ **镜像未推送到仓库**（最常见）
2. ❌ **镜像仓库不存在**
3. ❌ **需要登录**（私有仓库）
4. ❌ **镜像名称错误**

---

## ✅ 解决步骤

### 步骤 1: 检查镜像是否已推送

#### 方式一：浏览器检查（最快）

访问：`https://hub.docker.com/r/davidqin1995/minilpa-web`

**如果看到**：
- ✅ 页面显示镜像信息 → 镜像已推送
- ❌ 404 或 "Repository not found" → 镜像未推送

#### 方式二：使用检查脚本

```bash
cd /Users/jason/devTools/code/miniplapro/minilpa-web
bash check-image.sh davidqin1995/minilpa-web latest
```

---

### 步骤 2: 本地构建并推送

如果镜像未推送，执行以下步骤：

#### 2.1 确保 Docker Desktop 运行

```bash
# 检查 Docker 是否运行
docker info

# 如果未运行，启动 Docker Desktop
```

#### 2.2 进入项目目录

```bash
cd /Users/jason/devTools/code/miniplapro/minilpa-web
```

#### 2.3 登录 Docker Hub

```bash
docker login
# Username: davidqin1995
# Password: [您的密码或 Personal Access Token]
```

#### 2.4 构建并推送（一键）

```bash
bash build-and-push.sh
```

**或手动操作**：

```bash
# 1. 构建镜像
docker build -t davidqin1995/minilpa-web:latest .

# 2. 测试镜像（可选）
docker run -d -p 3001:3000 --name minilpa-test davidqin1995/minilpa-web:latest
curl http://localhost:3001/api/health
docker stop minilpa-test && docker rm minilpa-test

# 3. 推送镜像
docker push davidqin1995/minilpa-web:latest
```

#### 2.5 验证推送

```bash
# 使用检查脚本
bash check-image.sh

# 或浏览器访问
# https://hub.docker.com/r/davidqin1995/minilpa-web/tags
```

---

### 步骤 3: 服务器拉取

推送成功后，在服务器上执行：

```bash
# 重新拉取
docker pull davidqin1995/minilpa-web:latest

# 或使用部署脚本（自动拉取）
cd /www/wwwroot/minilpa-web
bash docker-pull-deploy.sh
```

---

## 🔍 常见问题

### 问题 1: Docker Hub 上找不到镜像

**原因**：镜像未推送

**解决**：
1. 在本地构建并推送
2. 等待几秒让镜像同步
3. 重新验证

---

### 问题 2: 推送时权限被拒绝

**原因**：未登录或登录失败

**解决**：
```bash
# 重新登录
docker logout
docker login

# 或使用 Personal Access Token
# 生成 Token: https://hub.docker.com/settings/security
```

---

### 问题 3: 构建失败

**原因**：代码或 Dockerfile 问题

**解决**：
```bash
# 查看构建日志
docker build -t test-image . 2>&1 | tee build.log

# 检查 Dockerfile
cat Dockerfile
```

---

## 📝 完整工作流程

### 本地构建推送

```bash
# 1. 进入项目目录
cd /Users/jason/devTools/code/miniplapro/minilpa-web

# 2. 确保代码是最新的
git pull origin main

# 3. 登录 Docker Hub
docker login

# 4. 构建并推送（一键）
bash build-and-push.sh v1.0.0

# 5. 验证推送
bash check-image.sh davidqin1995/minilpa-web v1.0.0
```

### 服务器部署

```bash
# 1. 进入项目目录
cd /www/wwwroot/minilpa-web

# 2. 配置环境变量
cp env.esim.haoyiseo.com .env

# 3. 拉取并部署（一键）
bash docker-pull-deploy.sh
```

---

## ✅ 检查清单

推送镜像前确认：

- [ ] Docker Desktop 已启动
- [ ] 已登录 Docker Hub (`docker login`)
- [ ] 项目代码是最新的
- [ ] 本地镜像构建成功
- [ ] 镜像测试通过（可选）
- [ ] 镜像推送成功（有 digest）
- [ ] 验证镜像存在于 Hub（检查脚本或浏览器）
- [ ] 服务器可以拉取镜像

---

## 🚀 快速修复命令

如果镜像未推送，在本地执行：

```bash
cd /Users/jason/devTools/code/miniplapro/minilpa-web && \
docker login && \
bash build-and-push.sh && \
bash check-image.sh davidqin1995/minilpa-web latest
```

推送成功后，在服务器上执行：

```bash
cd /www/wwwroot/minilpa-web && \
bash docker-pull-deploy.sh
```

---

**推荐：在本地先完成构建和推送，然后服务器拉取！** 🚀

