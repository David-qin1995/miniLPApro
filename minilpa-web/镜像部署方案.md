# ğŸ³ Docker é•œåƒéƒ¨ç½²æ–¹æ¡ˆ

## ğŸ“‹ ç›®å½•

- [æ–¹æ¡ˆä¼˜åŠ¿](#æ–¹æ¡ˆä¼˜åŠ¿)
- [å·¥ä½œæµç¨‹](#å·¥ä½œæµç¨‹)
- [æœ¬åœ°æ„å»ºå’Œæ¨é€](#æœ¬åœ°æ„å»ºå’Œæ¨é€)
- [æœåŠ¡å™¨æ‹‰å–å’Œéƒ¨ç½²](#æœåŠ¡å™¨æ‹‰å–å’Œéƒ¨ç½²)
- [é•œåƒä»“åº“é€‰æ‹©](#é•œåƒä»“åº“é€‰æ‹©)
- [ç‰ˆæœ¬ç®¡ç†](#ç‰ˆæœ¬ç®¡ç†)

---

## ğŸ¯ æ–¹æ¡ˆä¼˜åŠ¿

### âœ… vs æœåŠ¡å™¨æ„å»º

| ç‰¹æ€§ | æœ¬åœ°æ„å»º+é•œåƒéƒ¨ç½² | æœåŠ¡å™¨æ„å»º |
|------|-----------------|-----------|
| **æ„å»ºé€Ÿåº¦** | âœ… å¿«ï¼ˆæœ¬åœ°èµ„æºå¥½ï¼‰ | âŒ æ…¢ï¼ˆæœåŠ¡å™¨èµ„æºæœ‰é™ï¼‰ |
| **æœåŠ¡å™¨èµ„æº** | âœ… èŠ‚çœï¼ˆåªæ‹‰å–ï¼‰ | âŒ æ¶ˆè€—ï¼ˆéœ€è¦æ„å»ºï¼‰ |
| **ç½‘ç»œé—®é¢˜** | âœ… æ— ï¼ˆæœ¬åœ°ç½‘ç»œå¥½ï¼‰ | âŒ å®¹æ˜“å¡ä½ï¼ˆnpm å®‰è£…ï¼‰ |
| **éƒ¨ç½²é€Ÿåº¦** | âœ… ç§’çº§ï¼ˆæ‹‰å–å³å¯ï¼‰ | âŒ åˆ†é’Ÿçº§ï¼ˆéœ€è¦æ„å»ºï¼‰ |
| **ç‰ˆæœ¬ç®¡ç†** | âœ… æ¸…æ™°ï¼ˆtag ç®¡ç†ï¼‰ | âŒ éš¾ä»¥ç®¡ç† |
| **å›æ»šé€Ÿåº¦** | âœ… ç§’çº§ | âŒ éœ€è¦é‡æ–°æ„å»º |
| **é¢„æµ‹è¯•** | âœ… å¯ä»¥æœ¬åœ°æµ‹è¯• | âŒ æ— æ³•é¢„æµ‹è¯• |

---

## ğŸ”„ å·¥ä½œæµç¨‹

```
æœ¬åœ°å¼€å‘ç¯å¢ƒ
    â†“
æœ¬åœ°æ„å»ºé•œåƒ (build-and-push.sh)
    â†“
æ¨é€åˆ° Docker Hub / é˜¿é‡Œäº‘é•œåƒä»“åº“
    â†“
æœåŠ¡å™¨æ‹‰å–é•œåƒ (docker-pull-deploy.sh)
    â†“
è¿è¡Œå®¹å™¨ (docker-compose.image.yml)
    â†“
å®Œæˆéƒ¨ç½² âœ…
```

---

## ğŸ—ï¸ æœ¬åœ°æ„å»ºå’Œæ¨é€

### å‰ç½®è¦æ±‚

1. **å®‰è£… Docker Desktop**ï¼ˆæœ¬åœ°ï¼‰
2. **Docker Hub è´¦å·**ï¼ˆæˆ–é˜¿é‡Œäº‘é•œåƒä»“åº“è´¦å·ï¼‰
3. **ç™»å½• Docker Hub**

```bash
docker login
# è¾“å…¥ç”¨æˆ·åå’Œå¯†ç 
```

### æ­¥éª¤ 1: æ„å»ºé•œåƒ

```bash
cd /Users/jason/devTools/code/miniplapro/minilpa-web

# æ–¹å¼ä¸€ï¼šä½¿ç”¨è„šæœ¬ï¼ˆæ¨èï¼‰
bash build-and-push.sh

# æ–¹å¼äºŒï¼šæŒ‡å®šç‰ˆæœ¬å·
bash build-and-push.sh v1.0.0

# æ–¹å¼ä¸‰ï¼šæ‰‹åŠ¨æ„å»º
docker build -t davidqin1995/minilpa-web:latest .
```

### æ­¥éª¤ 2: æµ‹è¯•é•œåƒ

```bash
# æœ¬åœ°æµ‹è¯•è¿è¡Œ
docker run -d -p 3001:3000 --name minilpa-test davidqin1995/minilpa-web:latest

# æµ‹è¯•å¥åº·æ£€æŸ¥
curl http://localhost:3001/api/health

# åœæ­¢æµ‹è¯•å®¹å™¨
docker stop minilpa-test
docker rm minilpa-test
```

### æ­¥éª¤ 3: æ¨é€é•œåƒ

```bash
# ä½¿ç”¨è„šæœ¬ï¼ˆè‡ªåŠ¨æ¨é€ï¼‰
bash build-and-push.sh

# æˆ–æ‰‹åŠ¨æ¨é€
docker push davidqin1995/minilpa-web:latest
docker push davidqin1995/minilpa-web:v1.0.0
```

---

## ğŸš€ æœåŠ¡å™¨æ‹‰å–å’Œéƒ¨ç½²

### æ­¥éª¤ 1: å‡†å¤‡ç¯å¢ƒ

```bash
# SSH ç™»å½•æœåŠ¡å™¨
ssh root@your-server-ip

# å®‰è£… Docker
curl -fsSL https://get.docker.com | bash -
systemctl start docker
systemctl enable docker

# å®‰è£… docker-composeï¼ˆå¦‚æœæœªå®‰è£…ï¼‰
# æˆ–ä½¿ç”¨ docker composeï¼ˆDocker 20.10+ å†…ç½®ï¼‰
```

### æ­¥éª¤ 2: è·å–é¡¹ç›®ä»£ç 

```bash
cd /www/wwwroot
git clone https://github.com/David-qin1995/miniLPApro.git temp-minilpa
mv temp-minilpa/minilpa-web minilpa-web
rm -rf temp-minilpa
cd minilpa-web
```

### æ­¥éª¤ 3: é…ç½®ç¯å¢ƒå˜é‡

```bash
# å¤åˆ¶ç¯å¢ƒå˜é‡æ¨¡æ¿
cp env.esim.haoyiseo.com .env

# ç¼–è¾‘é…ç½®ï¼ˆå¦‚æœéœ€è¦ï¼‰
vim .env
```

### æ­¥éª¤ 4: ä¸€é”®éƒ¨ç½²

```bash
# ä½¿ç”¨éƒ¨ç½²è„šæœ¬ï¼ˆæ¨èï¼‰
bash docker-pull-deploy.sh

# æˆ–æŒ‡å®šç‰ˆæœ¬
bash docker-pull-deploy.sh v1.0.0
```

è„šæœ¬ä¼šè‡ªåŠ¨å®Œæˆï¼š
- âœ… æ‹‰å–æœ€æ–°é•œåƒ
- âœ… åœæ­¢æ—§å®¹å™¨
- âœ… å¯åŠ¨æ–°å®¹å™¨
- âœ… å¥åº·æ£€æŸ¥
- âœ… çŠ¶æ€éªŒè¯

---

## ğŸª é•œåƒä»“åº“é€‰æ‹©

### æ–¹æ¡ˆä¸€ï¼šDocker Hubï¼ˆæ¨èï¼‰â­â­â­â­â­

**ä¼˜ç‚¹**ï¼š
- âœ… å…¨çƒCDNï¼Œé€Ÿåº¦å¿«
- âœ… å…è´¹ä½¿ç”¨ï¼ˆå…¬å¼€ä»“åº“ï¼‰
- âœ… ä½¿ç”¨ç®€å•

**é…ç½®**ï¼š
```bash
IMAGE_NAME="davidqin1995/minilpa-web"
```

**ç™»å½•**ï¼š
```bash
docker login
```

---

### æ–¹æ¡ˆäºŒï¼šé˜¿é‡Œäº‘å®¹å™¨é•œåƒæœåŠ¡ï¼ˆå›½å†…æ¨èï¼‰â­â­â­â­â­

**ä¼˜ç‚¹**ï¼š
- âœ… å›½å†…è®¿é—®é€Ÿåº¦å¿«
- âœ… å…è´¹ä½¿ç”¨ï¼ˆæœ‰é¢åº¦é™åˆ¶ï¼‰
- âœ… æ”¯æŒç§æœ‰ä»“åº“

**é…ç½®**ï¼š

1. åˆ›å»ºå‘½åç©ºé—´å’Œä»“åº“
   - è®¿é—®ï¼šhttps://cr.console.aliyun.com/
   - åˆ›å»ºå‘½åç©ºé—´ï¼ˆå¦‚ï¼šminilpaï¼‰
   - åˆ›å»ºé•œåƒä»“åº“ï¼ˆå¦‚ï¼šminilpa-webï¼‰

2. ä¿®æ”¹é…ç½®
   ```bash
   IMAGE_NAME="registry.cn-hangzhou.aliyuncs.com/minilpa/minilpa-web"
   ```

3. ç™»å½•
   ```bash
   docker login --username=your-username registry.cn-hangzhou.aliyuncs.com
   ```

---

### æ–¹æ¡ˆä¸‰ï¼šè…¾è®¯äº‘å®¹å™¨é•œåƒæœåŠ¡

**ä¼˜ç‚¹**ï¼š
- âœ… å›½å†…è®¿é—®å¿«
- âœ… ä¸è…¾è®¯äº‘æœåŠ¡é›†æˆå¥½

**é…ç½®**ï¼š
```bash
IMAGE_NAME="ccr.ccs.tencentyun.com/your-namespace/minilpa-web"
```

---

## ğŸ·ï¸ ç‰ˆæœ¬ç®¡ç†

### æ ‡ç­¾ç­–ç•¥

```bash
# ä½¿ç”¨è¯­ä¹‰åŒ–ç‰ˆæœ¬å·
docker tag minilpa-web davidqin1995/minilpa-web:v1.0.0
docker tag minilpa-web davidqin1995/minilpa-web:latest

# æ¨é€ç‰ˆæœ¬
docker push davidqin1995/minilpa-web:v1.0.0
docker push davidqin1995/minilpa-web:latest
```

### ç‰ˆæœ¬æ¨è

- `latest` - æœ€æ–°ç¨³å®šç‰ˆ
- `v1.0.0` - å…·ä½“ç‰ˆæœ¬å·
- `v1.0.0-beta` - æµ‹è¯•ç‰ˆæœ¬
- `2023-10-31` - æ—¥æœŸç‰ˆæœ¬

---

## ğŸ“ å®Œæ•´ç¤ºä¾‹

### æœ¬åœ°æ„å»ºå’Œæ¨é€

```bash
# 1. è¿›å…¥é¡¹ç›®ç›®å½•
cd /Users/jason/devTools/code/miniplapro/minilpa-web

# 2. ç™»å½• Docker Hub
docker login

# 3. æ„å»ºå¹¶æ¨é€ï¼ˆè‡ªåŠ¨ï¼‰
bash build-and-push.sh v1.0.0

# æˆ–æ‰‹åŠ¨æ“ä½œï¼š
docker build -t davidqin1995/minilpa-web:v1.0.0 .
docker tag davidqin1995/minilpa-web:v1.0.0 davidqin1995/minilpa-web:latest
docker push davidqin1995/minilpa-web:v1.0.0
docker push davidqin1995/minilpa-web:latest
```

### æœåŠ¡å™¨éƒ¨ç½²

```bash
# 1. SSH ç™»å½•æœåŠ¡å™¨
ssh root@your-server-ip

# 2. è¿›å…¥é¡¹ç›®ç›®å½•
cd /www/wwwroot/minilpa-web

# 3. é…ç½®ç¯å¢ƒå˜é‡
cp env.esim.haoyiseo.com .env

# 4. ä¸€é”®éƒ¨ç½²
bash docker-pull-deploy.sh

# æˆ–æŒ‡å®šç‰ˆæœ¬
bash docker-pull-deploy.sh v1.0.0
```

---

## ğŸ”§ é«˜çº§ç”¨æ³•

### å¤šç¯å¢ƒéƒ¨ç½²

```bash
# ç”Ÿäº§ç¯å¢ƒ
docker-pull-deploy.sh v1.0.0

# æµ‹è¯•ç¯å¢ƒ
docker-pull-deploy.sh v1.0.0-beta
```

### å›æ»šåˆ°æ—§ç‰ˆæœ¬

```bash
# ç›´æ¥æŒ‡å®šæ—§ç‰ˆæœ¬å·
bash docker-pull-deploy.sh v0.9.0
```

### æŸ¥çœ‹é•œåƒåˆ—è¡¨

```bash
# Docker Hub
curl https://hub.docker.com/v2/repositories/davidqin1995/minilpa-web/tags

# æœ¬åœ°
docker images | grep minilpa-web
```

---

## âœ… ä¼˜åŠ¿æ€»ç»“

### ğŸš€ éƒ¨ç½²é€Ÿåº¦

- **æœ¬åœ°æ„å»º**: 2-5 åˆ†é’Ÿï¼ˆæ ¹æ®ç½‘ç»œï¼‰
- **æœåŠ¡å™¨æ‹‰å–**: 30 ç§’ - 2 åˆ†é’Ÿï¼ˆæ ¹æ®é•œåƒå¤§å°ï¼‰
- **æ€»è®¡**: 3-7 åˆ†é’Ÿå®Œæˆéƒ¨ç½²

vs **æœåŠ¡å™¨æ„å»º**: 10-30 åˆ†é’Ÿï¼ˆç”šè‡³æ›´ä¹…ï¼‰

### ğŸ’° èµ„æºèŠ‚çœ

- **æœåŠ¡å™¨ CPU**: åªç”¨äºè¿è¡Œï¼Œä¸ç”¨äºæ„å»º
- **æœåŠ¡å™¨å†…å­˜**: è¿è¡Œéœ€è¦ ~512MBï¼Œæ„å»ºéœ€è¦ ~2GB
- **æœåŠ¡å™¨å¸¦å®½**: åªæ‹‰å–é•œåƒï¼Œä¸éœ€è¦ä¸‹è½½å¤§é‡ npm åŒ…

### ğŸ”’ å¯é æ€§

- âœ… æœ¬åœ°æ„å»ºå¯ä»¥å……åˆ†æµ‹è¯•
- âœ… é¿å…æœåŠ¡å™¨ç½‘ç»œé—®é¢˜
- âœ… ç‰ˆæœ¬ç®¡ç†æ¸…æ™°
- âœ… å›æ»šé€Ÿåº¦å¿«

---

## ğŸ“Š å¯¹æ¯”æ€»ç»“

| é¡¹ç›® | æœ¬åœ°æ„å»º+é•œåƒ | æœåŠ¡å™¨æ„å»º |
|------|-------------|-----------|
| **æ„å»ºæ—¶é—´** | 3-5 åˆ†é’Ÿ | 10-30 åˆ†é’Ÿ |
| **æœåŠ¡å™¨èµ„æº** | ä½ï¼ˆåªè¿è¡Œï¼‰ | é«˜ï¼ˆæ„å»º+è¿è¡Œï¼‰ |
| **ç½‘ç»œä¾èµ–** | æ„å»ºæ—¶ï¼ˆæœ¬åœ°å¥½ï¼‰ | æ„å»ºæ—¶ï¼ˆæœåŠ¡å™¨å¯èƒ½å·®ï¼‰ |
| **éƒ¨ç½²é€Ÿåº¦** | å¿«ï¼ˆæ‹‰å–å³å¯ï¼‰ | æ…¢ï¼ˆéœ€è¦æ„å»ºï¼‰ |
| **ç‰ˆæœ¬ç®¡ç†** | âœ… æ¸…æ™° | âŒ éš¾ä»¥ç®¡ç† |
| **å›æ»š** | âœ… ç§’çº§ | âŒ éœ€è¦é‡å»º |
| **æ¨èåº¦** | â­â­â­â­â­ | â­â­â­ |

---

## ğŸ‰ æ¨èä½¿ç”¨é•œåƒéƒ¨ç½²æ–¹æ¡ˆï¼

**ä¼˜åŠ¿æ˜æ˜¾ï¼Œéƒ¨ç½²æ›´å¿«ï¼Œèµ„æºæ›´çœï¼Œç®¡ç†æ›´ç®€å•ï¼** ğŸš€

